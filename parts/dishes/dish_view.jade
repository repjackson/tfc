template(name='dish_view')
    with current_doc
        .ui.stackable.padded.grid
            .two.column.row
                .column
                    .ui.large.header 
                        //- small viewing
                        h1 #{title}
                        //- small dish
                    if can_edit
                        a.ui.large.circular.icon.button(href="/dish/#{_id}/edit")
                            i.pencil.blue.large.icon
                    img.ui.fluid.rounded.image(src="{{c.url image_id width=400 height=400}}")
                    div
                    .ui.inline.header 
                        small available 
                        |{{from_now datetime_available}}:
                    +textarea_view key='description' direct=true
                    .ui.small.inline.header {{long_date datetime_available}}
                    .ui.header 
                        +i name='ingredients'
                        |ingredients
                    each ingredients
                        .ui.label #{this}
                    //- .ui.dividing.header
                    //-     +i name='rules'
                    //-     |rules
                .column
                    .ui.header $#{franc_price}/serving
                    .ui.header $#{usd_price}/serving
                    if can_order
                        +order_button
                    .ui.header 
                        +i name='order-history'
                        |orders
                    each dish_orders
                        .ui.segment(class=dish_order_class)
                            .ui.inline.green.header
                                |$#{order_price}
                                if _author.image_id
                                    img.ui.avatar.image(src="{{c.url _author.image_id width=100 height=100 gravity='face' crop='fill'}}")
                                |#{_author.username}
                            div
                            .ui.small.inline.header
                                | #{when} ({{long_date _timestamp}})
                            a.ui.compact.circular.button(href="/order/#{_id}/view")
                                |view details
                                i.right.chevron.icon
                            if can_cancel
                                .ui.small.compact.button.cancel_order
                                    i.remove.red.icon
                                    |cancel
                    .ui.hidden.divider
                    +comments
                    


template(name='order_button')
    if open
        if servings_left
            .ui.green.fluid.large.circular.button.order_dish
                i.cart.plus.large.icon
                // |order #{serving_unit}
                |order
        else 
            .ui.grey.header sold out
            //- .ui.teal.large.fluid.circular.button.join_waitlist
            //-     i.clock.large.icon
            //-     |join wait list
    else 
        .ui.grey.header closed to new orders
